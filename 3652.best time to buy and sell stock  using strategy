from typing import List

class Solution:
    def maxProfit(self, prices: List[int], strategy: List[int], k: int) -> int:
        n = len(prices)
        base_profit = sum(p * s for p, s in zip(prices, strategy))
        if k == 0 or k > n:
            return base_profit
        half = k // 2
        old_sum = 0     
        sell_sum = 0   
        max_gain = 0
        for i in range(n):
            old_sum += strategy[i] * prices[i]
            sell_sum += prices[i]
            if i >= half:
                sell_sum -= prices[i - half]
            if i >= k:
                old_sum -= strategy[i - k] * prices[i - k]
            if i >= k - 1:
                gain = sell_sum - old_sum
                max_gain = max(max_gain, gain)
        return base_profit + max_gain
